#name: CI
#
#on:
#  pull_request:
#    branches:
#      - main
#      - develop
#  push:
#    branches:
#      - main
#      - develop
#
#jobs:
#  build:
#    name: build
#    runs-on: ubuntu-latest
#    permissions:
#      contents: read
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v4
#
#      - name: Setup Node.js
#        uses: actions/setup-node@v4
#        with:
#          node-version: '20'
#
#      - name: Enable Corepack
#        run: corepack enable
#
#      - name: Install dependencies
#        run: yarn install --immutable
#
#      - name: Build
#        run: yarn workspace docs build
#
#  test:
#    name: test
#    runs-on: ubuntu-latest
#    permissions:
#      contents: read
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v4
#
#      - name: Setup Node.js
#        uses: actions/setup-node@v4
#        with:
#          node-version: '20'
#
#      - name: Enable Corepack
#        run: corepack enable
#
#      - name: Install dependencies
#        run: yarn install --immutable
#
#      - name: Install Playwright browsers
#        run: yarn workspace docs exec playwright install --with-deps
#
#      - name: Run tests
#        run: yarn workspace docs exec vitest run
#
#  create-issue-on-failure:
#    name: Create issue on failure
#    runs-on: ubuntu-latest
#    needs: [build, test]
#    if: failure()
#    permissions:
#      contents: read
#      issues: write
#    steps:
#      - name: Create issue for build failure
#        uses: actions/github-script@v7
#        with:
#          script: |
#            const workflow_run_url = `${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`;
#            const failed_jobs = [];
#
#            // Get job information
#            const jobs = await github.rest.actions.listJobsForWorkflowRun({
#              owner: context.repo.owner,
#              repo: context.repo.repo,
#              run_id: context.runId,
#            });
#
#            for (const job of jobs.data.jobs) {
#              if (job.conclusion === 'failure') {
#                failed_jobs.push(`- **${job.name}**: ${job.html_url}`);
#              }
#            }
#
#            const issue_body = `## ðŸš¨ CI Build Failure
#
#            **Workflow**: ${context.workflow}
#            **Branch**: \`${context.ref.replace('refs/heads/', '')}\`
#            **Commit**: ${context.sha.substring(0, 7)}
#            **Triggered by**: @${context.actor}
#
#            ### Failed Jobs
#            ${failed_jobs.length > 0 ? failed_jobs.join('\n') : 'No specific job information available'}
#
#            ### Details
#            - **Workflow Run**: ${workflow_run_url}
#            - **Event**: ${context.eventName}
#
#            ### Action Required
#            Please review the failed jobs and fix the issues. Once fixed, close this issue.
#
#            ---
#            *This issue was automatically created by the CI workflow.*`;
#
#            // Check if there's already an open issue for this workflow
#            const issues = await github.rest.issues.listForRepo({
#              owner: context.repo.owner,
#              repo: context.repo.repo,
#              state: 'open',
#              labels: 'ci-failure',
#              per_page: 100
#            });
#
#            const existing_issue = issues.data.find(issue =>
#              issue.title.includes(context.workflow) &&
#              issue.title.includes(context.ref.replace('refs/heads/', ''))
#            );
#
#            if (existing_issue) {
#              // Add a comment to the existing issue
#              await github.rest.issues.createComment({
#                owner: context.repo.owner,
#                repo: context.repo.repo,
#                issue_number: existing_issue.number,
#                body: `### New Failure Detected\n\n${issue_body}`
#              });
#              console.log(`Added comment to existing issue #${existing_issue.number}`);
#            } else {
#              // Create a new issue
#              const issue = await github.rest.issues.create({
#                owner: context.repo.owner,
#                repo: context.repo.repo,
#                title: `CI Failure: ${context.workflow} on ${context.ref.replace('refs/heads/', '')}`,
#                body: issue_body,
#                labels: ['ci-failure', 'bug']
#              });
#              console.log(`Created issue #${issue.data.number}`);
#            }
